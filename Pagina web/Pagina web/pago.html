<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Paqueteria sin nombre | Pago Seguro</title>
</head>
<body>
    <div>
        <h2>Pasarela de Pago</h2>
        <p>Estás a un paso de generar tu guía.</p>
    </div>
    <hr>
    <div style="background: #eee; padding: 15px; margin-bottom: 20px;">
        <h3>Resumen de Orden</h3>
        <p><strong>Guía a Generar:</strong> <span id="displayGuia">...</span></p>
        <p><strong>Total a Pagar:</strong> <span id="displayTotal">...</span></p>
    </div>
    <form onsubmit="procesarPago(event)">
        <fieldset>
            <legend>Datos de Tarjeta</legend>
            <label>Titular:</label><br>
            <input type="text" required><br><br>
            <label>Número de Tarjeta:</label><br>
            <input type="text" maxlength="16" required><br><br>
            <label>Vencimiento (MM/AA):</label><br>
            <input type="text" style="width: 60px;" required>
            <label>CVV:</label>
            <input type="password" maxlength="3" style="width: 40px;" required>
        </fieldset>
        <br>
        <button type="button" onclick="window.history.back()">Regresar</button>
        <button type="submit"><strong>PAGAR Y GENERAR RECIBO</strong></button>
    </form>

    <script>
        function getParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name) || "No especificado";
        }

        window.onload = function() {
            document.getElementById('displayGuia').innerText = getParam('guia');
            document.getElementById('displayTotal').innerText = getParam('costo');
        };

        function procesarPago(e) {
            e.preventDefault();

            // 1. Recuperar TODOS los datos de la URL
            const guia = getParam('guia');
            const remitente = getParam('remitente');
            const destinatario = getParam('destinatario');
            const costo = getParam('costo');
            const dims = getParam('dims');
            // *** DATOS NUEVOS ***
            const dir_remitente = getParam('dir_remitente');
            const dir_destino = getParam('dir_destino');
            
            // 2. Generar el recibo (sin cambios)
            const fecha = new Date().toLocaleString();
            const recibo = 
                "********************************\n" +
                "      RECIBO OFICIAL MEXIPACK   \n" +
                "********************************\n\n" +
                "GUÍA DE RASTREO: " + guia + "\n" +
                "Remitente:   " + remitente + "\n" +
                "Destinatario:" + destinatario + "\n" +
                "TOTAL COBRADO: " + costo + "\n\n" +
                "********************************";
            alert(recibo);

            // 3. Redirigir a dashboard.html pasando TODOS los datos
            const url = "dashboard.html?" +
                "guia=" + encodeURIComponent(guia) +
                "&remitente=" + encodeURIComponent(remitente) +
                "&destinatario=" + encodeURIComponent(destinatario) +
                "&costo=" + encodeURIComponent(costo) +
                "&dims=" + encodeURIComponent(dims) +
                // *** AÑADIDOS A LA URL ***
                "&dir_remitente=" + encodeURIComponent(dir_remitente) + 
                "&dir_destino=" + encodeURIComponent(dir_destino) +
                "&estado=" + encodeURIComponent("Pagado (En Tránsito)");

            window.location.href = url;
        }
    </script>
</body>
</html>